<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>П'ятнашки 6x6: Бомби та Час</title>
  <style>
    /* Попередні стилі залишаються незмінними */
    
    /* Додаємо стилі для повідомлення про перемогу */
    .win-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(76, 175, 80, 0.95);
      color: white;
      padding: 20px 30px;
      border-radius: 10px;
      text-align: center;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      animation: fadeIn 0.5s;
      max-width: 80%;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    
    .win-message h2 {
      margin-top: 0;
      font-size: 1.5rem;
    }
    
    .win-message button {
      background: white;
      color: #4CAF50;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      margin-top: 15px;
      cursor: pointer;
      font-weight: bold;
    }
    
    /* Пришвидшуємо анімації */
    .tile {
      transition: transform 0.2s ease, background-color 0.2s ease;
    }
    
    .tile-move {
      transition: transform 0.15s ease-out;
    }
  </style>
</head>
<body>

<!-- Попередній HTML залишається незмінним -->

<script>
  // Змінюємо швидкість анімації руху
  function moveTile(index) {
    if (index === bombPosition) return;
    
    const emptyIndex = tiles.indexOf('');
    if (emptyIndex === -1) return;
    
    const row = Math.floor(index / gridSize);
    const emptyRow = Math.floor(emptyIndex / gridSize);
    
    const validMoves = [
      index - 1,    // ліво
      index + 1,    // право
      index - gridSize, // верх
      index + gridSize  // низ
    ];
    
    if (validMoves.includes(emptyIndex) && 
        (Math.abs(index - emptyIndex) === 1 ? row === emptyRow : true)) {
      // Швидша анімація руху
      const tileElement = document.querySelector(`.tile:nth-child(${index + 1})`);
      tileElement.classList.add('tile-move');
      tileElement.style.transform = 'scale(0.95) translate(0, 0)';
      
      setTimeout(() => {
        [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
        moves++;
        document.getElementById('moves').textContent = moves;
        render();
      }, 100); // Зменшуємо затримку
    }
  }

  // Оновлюємо функцію перевірки перемоги
  function checkWin() {
    const lastRow = tiles.slice(lastRowStart, lastRowStart + gridSize);
    const isWin = lastRow.every((tile, i) => tile === FINAL_ORDER[i]);
    
    if (isWin) {
      clearInterval(timer);
      
      // Додаємо результат до таблиці лідерів
      leaderboard.push({
        name: playerName,
        moves: moves,
        time: initialTime - timeLeft
      });
      
      leaderboard.sort((a, b) => a.moves - b.moves);
      if (leaderboard.length > 10) leaderboard = leaderboard.slice(0, 10);
      
      localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
      
      // Створюємо гарне повідомлення про перемогу
      const winMessage = document.createElement('div');
      winMessage.className = 'win-message';
      winMessage.innerHTML = `
        <h2>Вітаю, ${playerName}!</h2>
        <p>Ви перемогли за ${moves} ходів!</p>
        <p>Час: ${Math.floor((initialTime - timeLeft)/60)}:${((initialTime - timeLeft)%60).toString().padStart(2, '0')}</p>
        <button onclick="this.parentElement.remove(); setupGame()">Грати ще</button>
      `;
      document.body.appendChild(winMessage);
      
      updateLeaderboard();
    }
  }

  // В функції render додаємо видалення класу анімації після руху
  function render() {
    game.innerHTML = '';
    tiles.forEach((text, i) => {
      const div = document.createElement('div');
      div.className = 'tile';
      
      if (text === BOMB) {
        div.
          classList.add('bomb');
        div.textContent = BOMB;
      } else if (text === '') {
        div.classList.add('empty');
      } else if (badTiles.includes(text)) {
        div.classList.add('bad');
        div.textContent = text;
      } else {
        div.classList.add('good');
        div.textContent = text;
      }
      
      if (text !== BOMB && text !== '') {
        div.addEventListener('click', () => moveTile(i));
      }
      
      game.appendChild(div);
    });
    
    // Видаляємо клас анімації після завершення руху
    setTimeout(() => {
      document.querySelectorAll('.tile-move').forEach(el => {
        el.classList.remove('tile-move');
        el.style.transform = '';
      });
    }, 150);
    
    checkWin();
  }
</script>

</body>
</html>
