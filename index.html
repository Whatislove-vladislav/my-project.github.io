<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ù–µ–Ω–∞—Å–∏—Ç–Ω–∞ –ø–æ—Ä–æ–∂–Ω–µ—á–∞</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 10px;
      box-sizing: border-box;
    }
    h1 {
      margin-bottom: 10px;
      font-size: 1.5rem;
      text-align: center;
    }
    #stats {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 400px;
      margin-bottom: 10px;
    }
    .stat-box {
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #game {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 5px;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }
    .tile {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      border-radius: 3px;
      cursor: pointer;
      user-select: none;
      text-align: center;
      padding: 2px;
      transition: transform 0.15s ease-out, background-color 0.15s ease;
      min-width: 0;
      word-break: break-word;
      will-change: transform;
    }
    .tile:active {
      transform: scale(0.95);
    }
    .good {
      background: #fff;
      color: #000;
      box-shadow: 0 2px 3px rgba(0,0,0,0.1);
    }
    .bad {
      background: #000;
      color: #fff;
      box-shadow: 0 2px 3px rgba(0,0,0,0.2);
    }
    .empty {
      background: transparent;
      border: 1px dashed #ccc;
      cursor: default;
    }
    .bomb {
      background: #d32f2f;
      color: white;
      cursor: not-allowed;
      font-size: 16px;
    }
    #controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: opacity 0.2s;
    }
    button:active {
      opacity: 0.8;
    }
    #instructions {
      margin-top: 15px;
      padding: 10px;
      background: #fff;
      border-radius: 6px;
      max-width: 400px;
      text-align: center;
      font-size: 14px;
    }
    #leaderboard {
      margin-top: 15px;
      width: 100%;
      max-width: 400px;
      background: white;
      border-radius: 6px;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #leaderboard h2 {
      margin-top: 0;
      text-align: center;
      font-size: 1.2rem;
    }
    #leaderboard ol {
      padding-left: 20px;
    }
    .win-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(76, 175, 80, 0.95);
      color: white;
      padding: 20px 30px;
      border-radius: 10px;
      text-align: center;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s;
      max-width: 80%;
    }
    .timeout-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(211, 47, 47, 0.95);
      color: white;
      padding: 20px 30px;
      border-radius: 10px;
      text-align: center;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s;
      max-width: 80%;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    .win-message h2, .timeout-message h2 {
      margin-top: 0;
      font-size: 1.5rem;
    }
    .win-message button, .timeout-message button {
      background: white;
      color: #4CAF50;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      margin-top: 15px;
      cursor: pointer;
      font-weight: bold;
    }
    .timeout-message button {
      color: #d32f2f;
    }
    @media (max-width: 450px) {
      .tile {
        font-size: 9px;
      }
      #game {
        gap: 3px;
        max-width: 340px;
      }
    }
  </style>
</head>
<body>

<h1>–ù–µ–Ω–∞—Å–∏—Ç–Ω–∞ –ø–æ—Ä–æ–∂–Ω–µ—á–∞</h1>
<div id="stats">
  <div class="stat-box">–ß–∞—Å: <span id="timer">4:00</span></div>
  <div class="stat-box">–•–æ–¥–∏: <span id="moves">0</span></div>
  <div class="stat-box">–ü—Ä–∞–≤–∏–ª—å–Ω—ñ: <span id="correct">0</span>/6</div>
</div>
<div id="game"></div>
<div id="instructions">
  <strong>–ó–∞–≤–¥–∞–Ω–Ω—è:</strong> –†–æ–∑—Å—Ç–∞–≤—Ç–µ —á–æ—Ä–Ω—ñ –ø–ª–∏—Ç–∫–∏ –≤ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É —Ä—è–¥–∫—É —É –ø–æ—Ä—è–¥–∫—É:<br>
  –¢—ñ–∫ –¢–æ–∫ ‚Üí –†—ñ–ª—Å–∏ ‚Üí –ë—Ä–∞–≤–ª –°—Ç–∞—Ä—Å ‚Üí –Ü–Ω—Å—Ç–∞–≥—Ä–∞–º ‚Üí –Æ—Ç—É–± –®–æ—Ä—Ç—Å ‚Üí –°–Ω–∞–ø—á–∞—Ç<br>
  <span style="color: #d32f2f">üí£</span> - –ë–æ–º–±–∞ (–Ω–µ –ø–µ—Ä–µ—Å—É–≤–∞—î—Ç—å—Å—è)
</div>
<div id="controls">
  <button id="resetButton">–†–µ—Å—Ç–∞—Ä—Ç</button>
  <button id="newGameButton">–ù–æ–≤–∞ –≥—Ä–∞</button>
</div>
<div id="leaderboard">
  <h2>–¢–æ–ø 10 –≥—Ä–∞–≤—Ü—ñ–≤</h2>
  <ol id="scoresList"></ol>
</div>

<script>
  // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≥—Ä–∏
  const FINAL_ORDER = ['–¢—ñ–∫ –¢–æ–∫', '–†—ñ–ª—Å–∏', '–ë—Ä–∞–≤–ª –°—Ç–∞—Ä—Å', '–Ü–Ω—Å—Ç–∞–≥—Ä–∞–º', '–Æ—Ç—É–± –®–æ—Ä—Ç—Å', '–°–Ω–∞–ø—á–∞—Ç'];
  const gridSize = 6;
  const lastRowStart = gridSize * (gridSize - 1);
  const BOMB = 'üí£';
  const TIME_LIMIT = 4 * 60; // 4 —Ö–≤–∏–ª–∏–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  
  // –î–∞–Ω—ñ –≥—Ä–∏
  const goodTiles = [
    '–ü—Ä–æ–≥—É–ª—è—Ç–∏—Å—è', '–ü–æ—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è', '–î–æ–ø–æ–º–æ–≥—Ç–∏ –±–∞—Ç—å–∫–∞–º', '–°–ø–æ—Ä—Ç',
    '–ö–Ω–∏–≥–∞', '–ú–æ–ª–∏—Ç–≤–∞', '–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è', '–ú—É–∑–∏–∫–∞',
    '–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è', '–°–æ–Ω', '–£—Ä–æ–∫–∏', '–ù–∞—Å—Ç—ñ–ª—å–Ω—ñ —ñ–≥—Ä–∏',
    '–•–æ–±—ñ', '–ù–æ–≤–µ —Å–ª–æ–≤–æ', '–ú–∞–ª—é–≤–∞–Ω–Ω—è', '–ó–∞—Ä—è–¥–∫–∞',
    '–ß–∏—Ç–∞–Ω–Ω—è', '–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞', '–ì–æ—Ç—É–≤–∞–Ω–Ω—è', '–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Ñ—ñ–ª—å–º',
    '–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –ë—ñ–±–ª—ñ—ó', '–©–æ–¥–µ–Ω–Ω–∏–∫', '–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ', '–ù–∞–≤—á–∞–Ω–Ω—è'
  ];
  
  const badTiles = [...FINAL_ORDER];
  
  // –°—Ç–∞–Ω –≥—Ä–∏
  let tiles = [];
  let timer;
  let seconds = TIME_LIMIT;
  let moves = 0;
  let correctCount = 0;
  let playerName = "–ì—Ä–∞–≤–µ—Ü—å";
  let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏
  function initGame() {
    const savedName = localStorage.getItem('playerName');
    playerName = prompt("–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è:", savedName || "–ì—Ä–∞–≤–µ—Ü—å") || "–ì—Ä–∞–≤–µ—Ü—å";
    localStorage.setItem('playerName', playerName);
    setupGame();
  }

  function setupGame() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Å–∏–≤ –ø–ª–∏—Ç–æ–∫
    let allTiles = [...goodTiles, ...badTiles];
    
    // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –¥–≤–æ—Ö –±–æ–º–± (–æ–¥–Ω–∞ –≤ –ø–µ—Ä—à–∏—Ö –¥–≤–æ—Ö —Ä—è–¥–∫–∞—Ö, —ñ–Ω—à–∞ –≤ 1-3 —Ä—è–¥–∫–∞—Ö)
    const bombPosition1 = Math.floor(Math.random() * 12); // 0-11 (–ø–µ—Ä—à—ñ –¥–≤–∞ —Ä—è–¥–∏)
    const bombPosition2 = Math.floor(Math.random() * 18) + 6; // 6-23 (2-4 —Ä—è–¥–∏)
    
    // –î–æ–¥–∞—î–º–æ –ø–ª–∏—Ç–∫–∏ –¥–æ 34 –∫–ª—ñ—Ç–∏–Ω–æ–∫ (36 - 2 –±–æ–º–±–∏)
    while (allTiles.length < gridSize * gridSize - 2) {
      const randomTile = goodTiles[Math.floor(Math.random() * goodTiles.length)];
      allTiles.push(randomTile);
    }
    
    // –î–æ–¥–∞—î–º–æ 1 –ø—É—Å—Ç—É –∫–ª—ñ—Ç–∏–Ω–∫—É
    tiles = shuffle([...allTiles, '']);
    
    // –í—Å—Ç–∞–≤–ª—è—î–º–æ –±–æ–º–±–∏ –Ω–∞ –≤–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–∑–∏—Ü—ñ—ó
    tiles.splice(bombPosition1, 0, BOMB);
    if (bombPosition2 >= bombPosition1) {
      tiles.splice(bombPosition2 + 1, 0, BOMB);
    } else {
      tiles.splice(bombPosition2, 0, BOMB);
    }
    tiles = tiles.slice(0, gridSize * gridSize); // –û–±—Ä—ñ–∑–∞—î–º–æ –∑–∞–π–≤—ñ
    
    resetStats();
    render();
    updateLeaderboard();
  }

  // –°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  function resetStats() {
    clearInterval(timer);
    seconds = TIME_LIMIT;
    moves = 0;
    correctCount = 0;
    updateTimerDisplay();
    document.getElementById('moves').textContent = '0';
    document.getElementById('correct').textContent = '0';
    timer = setInterval(updateTimer, 1000);
  }

  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞ (–∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤—ñ–¥–ª—ñ–∫)
  function updateTimer() {
    seconds--;
    updateTimerDisplay();
    
    if (seconds <= 0) {
      clearInterval(timer);
      showTimeoutMessage();
    }
  }

  function updateTimerDisplay() {
    const minutes = Math.floor(seconds / 60);
    const secs = seconds % 60;
    document.getElementById('timer').textContent = `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    
    // –ó–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—É –ø—Ä–∏ –º–µ–Ω—à–µ 1 —Ö–≤–∏–ª–∏–Ω–∏
    if (seconds < 60) {
      document.getElementById('timer').style.color = '#d32f2f';
    } else {
      document.getElementById('timer').style.color = '';
    }
  }

  // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä–∏
  function render() {
    game.innerHTML = '';
    tiles.forEach((text, i) => {
      const div = document.createElement('div');
      div.className = 'tile';
      
      if (text === BOMB) {
        div.classList.add('bomb');
        div.textContent = BOMB;
      } else if (text === '') {
        div.classList.add('empty');
      } else if (badTiles.includes(text)) {
        div.classList.add('bad');
        div.textContent = text;
      } else {
        div.classList.add('good');
        div.textContent = text;
      }
      
      if (text !== BOMB && text !== '') {
        div.addEventListener('click', () => moveTile(i));
      }
      
      game.appendChild(div);
    });
    
    checkCorrectTiles();
  }

  // –†—É—Ö –ø–ª–∏—Ç–∫–∏
  function moveTile(index) {
    const emptyIndex = tiles.indexOf('');
    if (emptyIndex === -1) return;
    
    const row = Math.floor(index / gridSize);
    const emptyRow = Math.floor(emptyIndex / gridSize);
    const validMoves = [
      index - 1,    // –ª—ñ–≤–æ
      index + 1,    // –ø—Ä–∞–≤–æ
      index - gridSize, // –≤–µ—Ä—Ö
      index + gridSize  // –Ω–∏–∑
    ];
    
    if (validMoves.includes(emptyIndex) && 
        (Math.abs(index - emptyIndex) === 1 ? row === emptyRow : true)) {
      // –ê–Ω—ñ–º–∞—Ü—ñ—è —Ä—É—Ö—É
      const tileElement = document.querySelector(`.tile:nth-child(${index + 1})`);
      tileElement.style.transform = 'scale(0.95)';
      
      setTimeout(() => {
        [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
        moves++;
        document.getElementById('moves').textContent = moves;
        render();
      }, 100);
    }
  }

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏—Ö –ø–ª–∏—Ç–æ–∫
  function checkCorrectTiles() {
    const lastRow = tiles.slice(lastRowStart, lastRowStart + gridSize);
    let newCorrectCount = 0;
    
    for (let i = 0; i < FINAL_ORDER.length; i++) {
      if (lastRow[i] === FINAL_ORDER[i]) {
        newCorrectCount++;
      } else {
        break; // –¢—ñ–ª—å–∫–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–ª–∏—Ç–∫–∏
      }
    }
    
    if (newCorrectCount !== correctCount) {
      correctCount = newCorrectCount;
      document.getElementById('correct').textContent = correctCount;
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–≤–Ω—É –ø–µ—Ä–µ–º–æ–≥—É
    if (correctCount === FINAL_ORDER.length) {
      clearInterval(timer);
      showWinMessage();
    }
  }

  // –ü–æ–∫–∞–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–º–æ–≥—É
  function showWinMessage() {
    const message = document.createElement('div');
    message.className = 'win-message';
    message.innerHTML = `
      <h2>–í—ñ—Ç–∞—é, ${playerName}!</h2>
      <p>–í–∏ —Å–∫–ª–∞–ª–∏ ${correctCount} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–ª–∏—Ç–æ–∫!</p>
      <p>–í–∏—Ç—Ä–∞—Ç–∏–ª–∏ ${moves} —Ö–æ–¥—ñ–≤!</p>
      <p>–ó–∞–ª–∏—à–∏–ª–æ—Å—å —á–∞—Å—É: ${Math.floor(seconds/60)}:${seconds%60 < 10 ? '0' : ''}${seconds%60}</p>
      <button onclick="this.parentElement.remove(); setupGame()">–ì—Ä–∞—Ç–∏ —â–µ</button>
    `;
    document.body.appendChild(message);
    
    // –î–æ–¥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤
    leaderboard.push({
      name: playerName,
      correct: correctCount,
      moves: moves,
      timeLeft: seconds
    });
    
    // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–ª–∏—Ç–æ–∫ —ñ —á–∞—Å–æ–º
    leaderboard.sort((a, b) => {
      if (b.correct !== a.correct) return b.correct - a.correct;
      return b.timeLeft - a.timeLeft;
    });
    
    if (leaderboard.length > 10) leaderboard = leaderboard.slice(0, 10);
    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
    updateLeaderboard();
  }

  // –ü–æ–∫–∞–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —á–∞—Å—É
  function showTimeoutMessage() {
    const message = document.createElement('div');
    message.className = 'timeout-message';
    message.innerHTML = `
      <h2>–ß–∞—Å –≤–∏–π—à–æ–≤, ${playerName}!</h2>
      <p>–í–∏ –≤—Å—Ç–∏–≥–ª–∏ —Å–∫–ª–∞—Å—Ç–∏ ${correctCount} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–ª–∏—Ç–æ–∫ –∑ ${FINAL_ORDER.length}</p>
      <p>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Ö–æ–¥—ñ–≤: ${moves}</p>
      <button onclick="this.parentElement.remove(); setupGame()">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ</button>
    `;
    document.body.appendChild(message);
    
    // –î–æ–¥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤
    leaderboard.push({
      name: playerName,
      correct: correctCount,
      moves: moves,
      timeLeft: 0
    });
    
    // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–ª–∏—Ç–æ–∫
    leaderboard.sort((a, b) => b.correct - a.correct);
    
    if (leaderboard.length > 10) leaderboard = leaderboard.slice(0, 10);
    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
    updateLeaderboard();
  }

  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤
  function updateLeaderboard() {
    const scoresList = document.getElementById('scoresList');
    scoresList.innerHTML = '';
    
    leaderboard.slice(0, 10).forEach((player, index) => {
      const li = document.createElement('li');
      const minutes = Math.floor(player.timeLeft / 60);
      const secs = player.timeLeft % 60;
      li.innerHTML = `<strong>${player.name}</strong>: ${player.correct} –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö (${player.moves} —Ö–æ–¥—ñ–≤, –∑–∞–ª–∏—à. ${minutes}:${secs < 10 ? '0' : ''}${secs})`;
      scoresList.appendChild(li);
    });
  }

  // –ü–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤—É
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
  document.getElementById('resetButton').addEventListener('click', setupGame);
  document.getElementById('newGameButton').addEventListener('click', initGame);
  document.addEventListener('touchstart', function() {}, {passive: true});

  // –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏
  initGame();
</script>

</body>
</html>
