<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <!-- ✅ Мобільна оптимізація -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>П’ятнашки: Mental Detox</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        #game {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        .tile {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
            text-align: center;
            padding: 5px;
            transition: transform 0.2s ease;
            /* ✅ Мобільна оптимізація */
            min-width: 0;
            word-break: break-word;
        }

        .tile:active {
            transform: scale(0.95);
        }

        .good {
            background: #fff;
            color: #000;
        }

        .bad {
            background: #000;
            color: #fff;
        }

        .empty {
            background: transparent;
            border: 1px dashed #ccc;
            cursor: default;
        }

        /* ✅ Мобільна оптимізація */
        @media (max-width: 400px) {
            .tile {
                font-size: 12px;
            }
        }
    </style>
</head>

<body>

    <h1>П’ятнашки: Mental Detox</h1>
    <div id="game"></div>

    <script>
        const goodTiles = [
            'Прогулятися', 'Поспілкуватися з друзями', 'Допомогти батькам', 'Зайнятись спортом',
            'Почитати книгу', 'Помолитись', 'Прибрати дім', 'Послухати музику',
            'Розпланувати свій час', 'Добре виспатись', 'Зробити уроки', 'Пограти в настільну гру',
            'Зайнятися хобі'
        ];
        const badTiles = ['Рілси', 'Тік Ток'];
        const replacements = ['Досліджувати Біблію', 'Навчитись чомусь новому'];

        let tiles = [...goodTiles, ...badTiles];
        tiles = shuffle([...tiles, '']);

        const game = document.getElementById('game');
        const cornerIndex = 15; // ✅ Оптимізація: винесли у змінну

        function render() {
            game.innerHTML = '';
            tiles.forEach((text, i) => {
                const div = document.createElement('div');
                div.className = 'tile';
                if (text === '') {
                    div.classList.add('empty');
                } else if (badTiles.includes(text)) {
                    div.classList.add('bad');
                } else {
                    div.classList.add('good');
                }
                div.textContent = text;
                div.addEventListener('click', () => moveTile(i));
                game.appendChild(div);
            });
        }

        function moveTile(index) {
            const emptyIndex = tiles.indexOf('');
            const row = Math.floor(index / 4);
            const emptyRow = Math.floor(emptyIndex / 4);

            // ✅ Оптимізація: точніша перевірка допустимих ходів
            const validMoves = [
                index - 1,    // ліво
                index + 1,    // право
                index - 4,    // верх
                index + 4     // низ
            ];

            if (
                validMoves.includes(emptyIndex) &&
                (Math.abs(index - emptyIndex) === 1 ? row === emptyRow : true)
            ) {
                [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
                checkBadTileInCorner();
                render();
            }
        }

        function checkBadTileInCorner() {
            if (badTiles.includes(tiles[cornerIndex])) {
                const replacement = replacements[Math.floor(Math.random() * replacements.length)];
                tiles[cornerIndex] = replacement;
                // ✅ Візуальний фідбек для гравця
                setTimeout(() => {
                    alert(`Плитку замінено на: ${replacement}`);
                }, 100);
            }
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ✅ Додано обробник для сенсорних пристроїв
        document.addEventListener('touchstart', function () { }, { passive: true });

        render();
    </script>

</body>

</html>